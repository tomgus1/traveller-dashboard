const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-Bz9weoft.js","assets/excel-Du8kUxR_.js"])))=>i.map(i=>d[i]);
import{_ as C,D as S}from"./index-Cz5xk3vL.js";import"./icons-9UWp7c2_.js";import"./excel-Du8kUxR_.js";import"./vendor-Dfoqj1Wf.js";async function x(t,n){const o=await C(()=>import("./exceljs.min-Bz9weoft.js").then(c=>c.e),__vite__mapDeps([0,1])),e=new o.Workbook,r=await t.arrayBuffer();await e.xlsx.load(r);const a=structuredClone(S),i=c=>{const s=e.getWorksheet(c);if(!s)return[];const p=[],h=s.getRow(1),_=[];return h.eachCell((d,u)=>{_[u-1]=String(d.value||"")}),s.eachRow((d,u)=>{if(u===1)return;const g={};d.eachCell((f,w)=>{const y=_[w-1];y&&(g[y]=f.value||"")}),Object.values(g).some(f=>f!=="")&&p.push(g)}),p};a.Party_Finances=i("Party_Finances"),a.Ship_Accounts=i("Ship_Accounts"),a.Ship_Cargo=i("Ship_Cargo"),a.Ship_Maintenance_Log=i("Ship_Maintenance_Log"),a.Loans_Mortgage=i("Loans_Mortgage"),a.Party_Inventory=i("Party_Inventory"),a.Ammo_Tracker=i("Ammo_Tracker");const l=e.worksheets.map(c=>c.name);for(const c of l)if(c.endsWith("_Finance")){const s=c.replace("_Finance",""),p=i(`${s}_Finance`);a.PCs[s]||(a.PCs[s]={Finance:[],Inventory:[],Weapons:[],Armour:[],Ammo:[]}),a.PCs[s].Finance=p;const h=i(`${s}_Inventory`);h.length>0&&(a.PCs[s].Inventory=h)}n(a)}const A=t=>t.map(n=>{const o={};return Object.entries(n).forEach(([e,r])=>{r==null?o[e]="":typeof r=="number"&&!isNaN(r)?o[e]=r:o[e]=String(r)}),o}),m=(t,n,o,e)=>{const r=A(o),a=r.length>0?Object.keys(r[0]):e||[];if(a.length===0)return;const i=n.slice(0,31).replace(/[\\/?*[\]:–—]/g,"_").replace(/[^\w\s-_]/g,"_").trim(),l=t.addWorksheet(i),c=l.addRow(a);c.font={bold:!0},c.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFCCCCCC"}},r.forEach(s=>{const p=a.map(h=>{const _=s[h];return typeof _=="number"?_:_==null?"":String(_)});l.addRow(p)}),l.columns.forEach((s,p)=>{const h=a[p];h&&(s.width=Math.min(Math.max(h.length+2,10),30))})},P=(t,n)=>{m(t,"Party_Finances",n.Party_Finances,["Date","Description","Category","Amount (Cr)"]),m(t,"Ship_Accounts",n.Ship_Accounts,["Date","Description","Category","Amount (Cr)"]),m(t,"Ship_Cargo",n.Ship_Cargo,["Leg/Route","Item","Tons","Purchase World","Purchase Price (Cr/ton)","Sale World","Sale Price (Cr/ton)"]),n.Ship_Maintenance_Log.length>0&&m(t,"Ship_Maintenance_Log",n.Ship_Maintenance_Log,["Date","Type","Description","Cost (Cr)"]),n.Loans_Mortgage.length>0&&m(t,"Loans_Mortgage",n.Loans_Mortgage,["Loan Type","Principal","Interest Rate","Monthly Payment","Remaining Balance"]),n.Party_Inventory.length>0&&m(t,"Party_Inventory",n.Party_Inventory,["Item","Qty","Unit Value (Cr)","Total Value (Cr)"]),n.Ammo_Tracker.length>0&&m(t,"Ammo_Tracker",n.Ammo_Tracker,["Weapon","Ammo Type","Magazine Size","Rounds Loaded"])},v=(t,n)=>{for(const[o,e]of Object.entries(n.PCs)){const r=o.length>20?o.substring(0,20):o;m(t,`${r}_Finance`,e.Finance||[],["Date","Description","Category","Amount (Cr)"]),e.Inventory&&e.Inventory.length>0&&m(t,`${r}_Inventory`,e.Inventory,["Item","Qty","Unit Value (Cr)","Total Value (Cr)"]),e.Weapons&&e.Weapons.length>0&&m(t,`${r}_Weapons`,e.Weapons,["Weapon","Type","Damage","Range","Mass","Cost"]),e.Armour&&e.Armour.length>0&&m(t,`${r}_Armour`,e.Armour,["Armour","Type","Protection","Mass","Cost"]),e.Ammo&&e.Ammo.length>0&&m(t,`${r}_Ammo`,e.Ammo,["Weapon","Ammo Type","Magazine Size","Rounds Loaded"])}};async function E(t){try{const n=await C(()=>import("./exceljs.min-Bz9weoft.js").then(c=>c.e),__vite__mapDeps([0,1])),o=new n.Workbook;o.creator="Traveller Campaign Dashboard",o.created=new Date,o.modified=new Date,o.lastPrinted=new Date,P(o,t),v(o,t);const e=`Traveller_Campaign_Export_${new Date().toISOString().slice(0,10)}.xlsx`,r=await o.xlsx.writeBuffer({useSharedStrings:!0,useStyles:!0}),a=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(a),l=document.createElement("a");l.href=i,l.download=e,l.style.display="none",document.body.appendChild(l),l.click(),setTimeout(()=>{document.body.removeChild(l),window.URL.revokeObjectURL(i)},100)}catch(n){throw n instanceof Error?new Error(`Export failed: ${n.message}`):new Error("Export failed: Unknown error")}}export{E as exportXlsx,x as importXlsx};
