import{r as S}from"./excel-BEqrO8Q9.js";import{D as w,P as _}from"./index-bKV4J63X.js";import"./icons-DUJkaGZa.js";import"./vendor-Dfoqj1Wf.js";var y=S();async function L(o,e){const i=new y.Workbook,t=await o.arrayBuffer();await i.xlsx.load(t);const n=structuredClone(w),r=a=>{const c=i.getWorksheet(a);if(!c)return[];const p=[],d=c.getRow(1),h=[];return d.eachCell((m,l)=>{h[l-1]=String(m.value||"")}),c.eachRow((m,l)=>{if(l===1)return;const u={};m.eachCell((f,C)=>{const g=h[C-1];g&&(u[g]=f.value||"")}),Object.values(u).some(f=>f!=="")&&p.push(u)}),p};n.Party_Finances=r("Party_Finances"),n.Ship_Accounts=r("Ship_Accounts"),n.Ship_Cargo=r("Ship_Cargo"),n.Ship_Maintenance_Log=r("Ship_Maintenance_Log"),n.Loans_Mortgage=r("Loans_Mortgage"),n.Party_Inventory=r("Party_Inventory"),n.Ammo_Tracker=r("Ammo_Tracker");for(const a of _){const c=r(`${a}_Finance`),p=r(`${a}_Inventory`);n.PCs[a].Finance=c,n.PCs[a].Inventory=p}e(n)}const A=o=>o.map(e=>{const i={};return Object.entries(e).forEach(([t,n])=>{n==null?i[t]="":typeof n=="number"&&!isNaN(n)?i[t]=n:i[t]=String(n)}),i}),s=(o,e,i,t)=>{const n=A(i),r=n.length>0?Object.keys(n[0]):t||[];if(r.length===0)return;const a=e.slice(0,31).replace(/[\\/?*[\]:–—]/g,"_").replace(/[^\w\s-_]/g,"_").trim(),c=o.addWorksheet(a),p=c.addRow(r);p.font={bold:!0},p.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFCCCCCC"}},n.forEach(d=>{const h=r.map(m=>{const l=d[m];return typeof l=="number"?l:l==null?"":String(l)});c.addRow(h)}),c.columns.forEach((d,h)=>{const m=r[h];m&&(d.width=Math.min(Math.max(m.length+2,10),30))})},P=(o,e)=>{s(o,"Party_Finances",e.Party_Finances,["Date","Description","Category","Amount (Cr)"]),s(o,"Ship_Accounts",e.Ship_Accounts,["Date","Description","Category","Amount (Cr)"]),s(o,"Ship_Cargo",e.Ship_Cargo,["Leg/Route","Item","Tons","Purchase World","Purchase Price (Cr/ton)","Sale World","Sale Price (Cr/ton)"]),e.Ship_Maintenance_Log.length>0&&s(o,"Ship_Maintenance_Log",e.Ship_Maintenance_Log,["Date","Type","Description","Cost (Cr)"]),e.Loans_Mortgage.length>0&&s(o,"Loans_Mortgage",e.Loans_Mortgage,["Loan Type","Principal","Interest Rate","Monthly Payment","Remaining Balance"]),e.Party_Inventory.length>0&&s(o,"Party_Inventory",e.Party_Inventory,["Item","Qty","Unit Value (Cr)","Total Value (Cr)"]),e.Ammo_Tracker.length>0&&s(o,"Ammo_Tracker",e.Ammo_Tracker,["Weapon","Ammo Type","Magazine Size","Rounds Loaded"])},v=(o,e)=>{for(const i of _){const t=e.PCs[i],n=i.split(" ")[0];s(o,`${n}_Finance`,t.Finance||[],["Date","Description","Category","Amount (Cr)"]),t.Inventory&&t.Inventory.length>0&&s(o,`${n}_Inventory`,t.Inventory,["Item","Qty","Unit Value (Cr)","Total Value (Cr)"]),t.Weapons&&t.Weapons.length>0&&s(o,`${n}_Weapons`,t.Weapons,["Weapon","Type","Damage","Range","Mass","Cost"]),t.Armour&&t.Armour.length>0&&s(o,`${n}_Armour`,t.Armour,["Armour","Type","Protection","Mass","Cost"]),t.Ammo&&t.Ammo.length>0&&s(o,`${n}_Ammo`,t.Ammo,["Weapon","Ammo Type","Magazine Size","Rounds Loaded"])}};async function M(o){try{const e=new y.Workbook;e.creator="Traveller Campaign Dashboard",e.created=new Date,e.modified=new Date,e.lastPrinted=new Date,P(e,o),v(e,o);const i=`Traveller_Campaign_Export_${new Date().toISOString().slice(0,10)}.xlsx`,t=await e.xlsx.writeBuffer({useSharedStrings:!0,useStyles:!0}),n=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=i,a.style.display="none",document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),window.URL.revokeObjectURL(r)},100)}catch(e){throw e instanceof Error?new Error(`Export failed: ${e.message}`):new Error("Export failed: Unknown error")}}export{M as exportXlsx,L as importXlsx};
