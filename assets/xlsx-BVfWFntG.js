import{r as S}from"./excel-BEqrO8Q9.js";import{D as w,P as d}from"./index-B3UeoBVO.js";import"./icons-DUJkaGZa.js";import"./vendor-Dfoqj1Wf.js";var y=S();async function I(n,t){const a=new y.Workbook,r=await n.arrayBuffer();await a.xlsx.load(r);const e=structuredClone(w),o=c=>{const i=a.getWorksheet(c);if(!i)return[];const l=[],p=i.getRow(1),_=[];return p.eachCell((m,u)=>{_[u-1]=String(m.value||"")}),i.eachRow((m,u)=>{if(u===1)return;const h={};m.eachCell((f,C)=>{const g=_[C-1];g&&(h[g]=f.value||"")}),Object.values(h).some(f=>f!=="")&&l.push(h)}),l};e.Party_Finances=o("Party_Finances"),e.Ship_Accounts=o("Ship_Accounts"),e.Ship_Cargo=o("Ship_Cargo"),e.Ship_Maintenance_Log=o("Ship_Maintenance_Log"),e.Loans_Mortgage=o("Loans_Mortgage"),e.Party_Inventory=o("Party_Inventory"),e.Ammo_Tracker=o("Ammo_Tracker");for(const c of d){const i=o(`${c}_Finance`),l=o(`${c}_Inventory`);e.PCs[c].Finance=i,e.PCs[c].Inventory=l}t(e)}const R=n=>n.map(t=>{const a={};return Object.entries(t).forEach(([r,e])=>{e==null?a[r]="":typeof e=="number"&&!isNaN(e)?a[r]=e:a[r]=String(e)}),a}),s=(n,t,a,r)=>{const e=R(a),o=e.length>0?Object.keys(e[0]):r||[];if(o.length===0)return;const c=t.slice(0,31).replace(/[\\/?*[\]]/g,"_").trim(),i=n.addWorksheet(c);i.addRow(o);const l=i.getRow(1);l.font={bold:!0},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}},e.forEach(p=>{const _=o.map(m=>p[m]||"");i.addRow(_)}),i.columns.forEach(p=>{p.header&&(p.width=Math.max(String(p.header).length,15))})},A=(n,t)=>{s(n,"Party_Finances",t.Party_Finances,["Date","Description","Amount (Cr)","Running Total"]),s(n,"Ship_Accounts",t.Ship_Accounts,["Date","Description","Amount (Cr)","Running Total"]),s(n,"Ship_Cargo",t.Ship_Cargo,["Item","Quantity","Unit Value (Cr)","Total Value (Cr)"]),s(n,"Ship_Maintenance_Log",t.Ship_Maintenance_Log,["Date","Item","Hours"]),s(n,"Loans_Mortgage",t.Loans_Mortgage,["Loan","Principal","Interest Rate","Monthly Payment","Balance"]),s(n,"Party_Inventory",t.Party_Inventory,["Item","Quantity","Unit Value (Cr)","Total Value (Cr)"]),s(n,"Ammo_Tracker",t.Ammo_Tracker,["Character","Weapon","Type","Count"])},x=(n,t)=>{for(const a of d){const r=t.PCs[a];s(n,`${a}_Finance`,r.Finance||[],["Date","Description","Amount (Cr)","Running Total"]),s(n,`${a}_Inventory`,r.Inventory||[],["Item","Quantity","Unit Value (Cr)","Total Value (Cr)"]),s(n,`${a}_Weapons`,r.Weapons||[],["Weapon","Damage","Range","Mass","Cost"]),s(n,`${a}_Armour`,r.Armour||[],["Armour","Protection","Mass","Cost"]),s(n,`${a}_Ammo`,r.Ammo||[],["Weapon","Type","Count"])}};async function L(n){const t=new y.Workbook;A(t,n),x(t,n);const a=`Traveller_Campaign_Export_${new Date().toISOString().slice(0,10)}.xlsx`,r=await t.xlsx.writeBuffer(),e=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(e),c=document.createElement("a");c.href=o,c.download=a,c.click(),window.URL.revokeObjectURL(o)}export{L as exportXlsx,I as importXlsx};
